#!/bin/sh

################################################################################
################################################################################

TPL=$1

################################################################################
################################################################################

SED=@SED@

################################################################################
################################################################################

ROOT_NAME=cmap-$(basename $PWD)-$(basename $TPL .tpl)
ROOT_NAME=$(echo $ROOT_NAME | tr 'A-Z.' 'a-z-')
H_NAME=$ROOT_NAME.h
C_NAME=$ROOT_NAME.c

VAR=$(echo $ROOT_NAME | tr 'a-z-' 'A-Z_')

SED_ARGS="-e 's/\"/\\\\\"/g'"
SED_ARGS+=" -e 's/@\(.*\)@/\" \1 \"/g'"

TPL_CHAR_PTR=$(eval $SED $SED_ARGS $TPL | \
  while read -r; do echo -n "$REPLY\\n"; done)

################################################################################
################################################################################

cat << _EOF_ > $H_NAME
#ifndef __${VAR}_H__
#define __${VAR}_H__

extern const char * $VAR;

#endif
_EOF_

################################################################################
################################################################################

cat << _EOF_ > $C_NAME

#include "$H_NAME"

const char * $VAR = "$TPL_CHAR_PTR";
_EOF_
